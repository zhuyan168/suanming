# å¹´åº¦è¿åŠ¿ - ä¼šå‘˜åŠŸèƒ½æ¥å£è¯´æ˜

## âœ… å·²å®ç°çš„ä¼šå‘˜éªŒè¯æ¥å£

### ğŸ“ å®ç°ä½ç½®

å·²ä¸ºä»¥ä¸‹é¡µé¢æ·»åŠ å®Œæ•´çš„ä¼šå‘˜éªŒè¯æ¥å£ï¼š

1. **`pages/fortune/annual/index.tsx`** - å¹´åº¦è¿åŠ¿å…¥å£é¡µé¢
2. **`pages/fortune/annual/eastern.tsx`** - ç”Ÿè‚–æ˜“ç»å¹´è¿é¡µé¢
3. **`pages/fortune/annual/tarot.tsx`** - å¡”ç½—å¹´åº¦è¿åŠ¿ï¼ˆå·²å®ç°å®Œæ•´åŠŸèƒ½ï¼‰

---

## ğŸ” ä¼šå‘˜éªŒè¯æœºåˆ¶

### 1. ç”¨æˆ·çŠ¶æ€ç±»å‹å®šä¹‰

```typescript
interface User {
  id?: string;
  membership?: 'free' | 'premium' | 'vip';
  isPaid?: boolean;
}
```

æ”¯æŒä¸‰ç§ä¼šå‘˜ç­‰çº§ï¼š
- `free` - å…è´¹ç”¨æˆ·
- `premium` - é«˜çº§ä¼šå‘˜
- `vip` - VIPä¼šå‘˜

### 2. ä¼šå‘˜åˆ¤æ–­é€»è¾‘

```typescript
const isMember = user?.membership === 'premium' 
  || user?.membership === 'vip' 
  || user?.isPaid === true;
```

### 3. ç”¨æˆ·çŠ¶æ€è·å–

ä½¿ç”¨ `useEffect` åœ¨é¡µé¢åŠ è½½æ—¶ä» localStorage è·å–ç”¨æˆ·ä¿¡æ¯ï¼š

```typescript
useEffect(() => {
  // ä» localStorage è·å–ç”¨æˆ·æ•°æ®
  const userData = localStorage.getItem('user');
  if (userData) {
    try {
      const parsedUser = JSON.parse(userData);
      setUser(parsedUser);
      setIsPaid(parsedUser.membership === 'premium' 
        || parsedUser.membership === 'vip' 
        || parsedUser.isPaid === true);
    } catch (e) {
      console.error('Failed to parse user data:', e);
    }
  }
  
  // å¦‚æœæ²¡æœ‰ç”¨æˆ·æ•°æ®ï¼Œé»˜è®¤ä¸ºå…è´¹ç”¨æˆ·
  if (!userData) {
    setUser({ membership: 'free', isPaid: false });
    setIsPaid(false);
  }
}, []);
```

### 4. ä¼šå‘˜æƒé™æ£€æŸ¥ï¼ˆå·²é¢„ç•™ï¼‰

åœ¨å…¥å£é¡µé¢çš„ `handleCardClick` å‡½æ•°ä¸­ï¼š

```typescript
const handleCardClick = (path: string, isPremium: boolean = true) => {
  // å¹´åº¦è¿åŠ¿æ˜¯ä¼šå‘˜åŠŸèƒ½ï¼Œéœ€è¦éªŒè¯ä¼šå‘˜çŠ¶æ€
  // æš‚æ—¶ç»•è¿‡ä¼šå‘˜æ£€æŸ¥ï¼Œæ–¹ä¾¿æŸ¥çœ‹ç•Œé¢
  // if (isPremium && !isMember) {
  //   router.push('/membership/unlock');
  //   return;
  // }
  
  router.push(path);
};
```

åœ¨å­é¡µé¢ï¼ˆtarot.tsx, eastern.tsxï¼‰çš„ `useEffect` ä¸­ï¼š

```typescript
// ä¼šå‘˜æƒé™æ£€æŸ¥ï¼ˆæš‚æ—¶æ³¨é‡Šï¼Œæ–¹ä¾¿å¼€å‘è°ƒè¯•ï¼‰
// if (!isMember) {
//   router.push('/membership/unlock');
// }
```

---

## ğŸ¨ UI ä¼šå‘˜æ ‡è¯†

### 1. é¡µé¢æ ‡é¢˜ä¸‹æ–¹æç¤º

åœ¨å…¥å£é¡µé¢æ ‡é¢˜ä¸‹æ–¹æ·»åŠ äº†ä¼šå‘˜åŠŸèƒ½æç¤ºï¼š

```tsx
<div className="flex items-center justify-center gap-2 text-primary/80 text-sm">
  <svg>...</svg>
  <span className="font-medium">ä¼šå‘˜ä¸“äº«åŠŸèƒ½</span>
</div>
```

### 2. å¡ç‰‡å³ä¸Šè§’ä¼šå‘˜æ ‡è¯†

æ¯ä¸ªå…¥å£å¡ç‰‡å³ä¸Šè§’æ˜¾ç¤º"ä¼šå‘˜ä¸“äº«"å¾½ç« ï¼š

```tsx
<div className="absolute top-4 right-4">
  <div className="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-primary/20 border border-primary/40">
    <svg>...</svg>
    <span className="text-xs font-semibold text-primary">ä¼šå‘˜ä¸“äº«</span>
  </div>
</div>
```

---

## ğŸ”§ å¯ç”¨ä¼šå‘˜éªŒè¯

### åœ¨å…¥å£é¡µé¢å¯ç”¨

åœ¨ `pages/fortune/annual/index.tsx` ä¸­ï¼Œå–æ¶ˆæ³¨é‡Šä»¥ä¸‹ä»£ç ï¼š

```typescript
const handleCardClick = (path: string, isPremium: boolean = true) => {
  // å–æ¶ˆæ³¨é‡Šä¸‹é¢çš„ä»£ç ä»¥å¯ç”¨ä¼šå‘˜éªŒè¯
  if (isPremium && !isMember) {
    router.push('/membership/unlock');
    return;
  }
  
  router.push(path);
};
```

### åœ¨å­é¡µé¢å¯ç”¨

åœ¨ `pages/fortune/annual/eastern.tsx` ä¸­ï¼Œå–æ¶ˆæ³¨é‡Šï¼š

```typescript
useEffect(() => {
  // ... ç”¨æˆ·çŠ¶æ€è·å–ä»£ç  ...
  
  // å–æ¶ˆæ³¨é‡Šä¸‹é¢çš„ä»£ç ä»¥å¯ç”¨ä¼šå‘˜éªŒè¯
  if (!isMember) {
    router.push('/membership/unlock');
  }
}, []);
```

---

## ğŸ“‹ é›†æˆåˆ°å…¨å±€çŠ¶æ€ç®¡ç†

### æ¨èæ–¹æ¡ˆ

ç›®å‰ä½¿ç”¨ localStorage å­˜å‚¨ç”¨æˆ·çŠ¶æ€ï¼Œå»ºè®®åç»­é›†æˆåˆ°å…¨å±€çŠ¶æ€ç®¡ç†ï¼š

#### é€‰é¡¹ 1: React Context

```typescript
// contexts/UserContext.tsx
import { createContext, useContext, useState, useEffect } from 'react';

const UserContext = createContext<UserContextType | null>(null);

export const UserProvider = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [isMember, setIsMember] = useState(false);
  
  // ... ç”¨æˆ·çŠ¶æ€é€»è¾‘
  
  return (
    <UserContext.Provider value={{ user, isMember, setUser }}>
      {children}
    </UserContext.Provider>
  );
};

export const useUser = () => useContext(UserContext);
```

#### é€‰é¡¹ 2: Zustand

```typescript
// stores/userStore.ts
import create from 'zustand';

interface UserStore {
  user: User | null;
  isMember: boolean;
  setUser: (user: User) => void;
}

export const useUserStore = create<UserStore>((set) => ({
  user: null,
  isMember: false,
  setUser: (user) => set({ 
    user, 
    isMember: user.membership === 'premium' || user.membership === 'vip' || user.isPaid 
  }),
}));
```

#### é€‰é¡¹ 3: Redux Toolkit

```typescript
// features/user/userSlice.ts
import { createSlice } from '@reduxjs/toolkit';

const userSlice = createSlice({
  name: 'user',
  initialState: { user: null, isMember: false },
  reducers: {
    setUser: (state, action) => {
      state.user = action.payload;
      state.isMember = action.payload.membership === 'premium' 
        || action.payload.membership === 'vip' 
        || action.payload.isPaid;
    },
  },
});
```

---

## ğŸ”„ ä¸åç«¯ API é›†æˆ

### æ¨èæµç¨‹

```typescript
useEffect(() => {
  const fetchUserStatus = async () => {
    try {
      const response = await fetch('/api/user/status', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      
      const userData = await response.json();
      setUser(userData);
      setIsPaid(userData.membership === 'premium' || userData.membership === 'vip');
    } catch (error) {
      console.error('Failed to fetch user status:', error);
      // é™çº§åˆ° localStorage
      const cachedUser = localStorage.getItem('user');
      if (cachedUser) {
        setUser(JSON.parse(cachedUser));
      }
    }
  };
  
  fetchUserStatus();
}, []);
```

---

## ğŸ“± ä¼šå‘˜è§£é”é¡µé¢

å»ºè®®åˆ›å»ºä¼šå‘˜è§£é”æç¤ºé¡µé¢ `/membership/unlock`ï¼š

```typescript
// pages/membership/unlock.tsx
export default function MembershipUnlock() {
  return (
    <div className="min-h-screen flex items-center justify-center">
      <div className="max-w-md text-center">
        <h1 className="text-3xl font-bold mb-4">ä¼šå‘˜ä¸“äº«åŠŸèƒ½</h1>
        <p className="text-white/70 mb-8">
          å¹´åº¦è¿åŠ¿æ˜¯ä¼šå‘˜ä¸“äº«åŠŸèƒ½ï¼Œå‡çº§ä¼šå‘˜å³å¯è§£é”å®Œæ•´ä½“éªŒ
        </p>
        <button className="px-8 py-3 bg-primary rounded-lg">
          ç«‹å³å‡çº§ä¼šå‘˜
        </button>
      </div>
    </div>
  );
}
```

---

## âœ… å½“å‰çŠ¶æ€

- âœ… ä¼šå‘˜éªŒè¯æ¥å£å·²é¢„ç•™
- âœ… ç”¨æˆ·çŠ¶æ€ç®¡ç†å·²å®ç°
- âœ… ä¼šå‘˜åˆ¤æ–­é€»è¾‘å·²å®Œæˆ
- âœ… UI ä¼šå‘˜æ ‡è¯†å·²æ·»åŠ 
- â¸ï¸ ä¼šå‘˜éªŒè¯å·²æ³¨é‡Šï¼ˆæ–¹ä¾¿å¼€å‘è°ƒè¯•ï¼‰
- â¸ï¸ ç­‰å¾…é›†æˆåˆ°å…¨å±€çŠ¶æ€ç®¡ç†
- â¸ï¸ ç­‰å¾…åˆ›å»ºä¼šå‘˜è§£é”é¡µé¢

## ğŸš€ å¯ç”¨æ­¥éª¤

1. **åˆ›å»ºä¼šå‘˜è§£é”é¡µé¢** (`/membership/unlock`)
2. **å–æ¶ˆæ³¨é‡Šä¼šå‘˜éªŒè¯ä»£ç **
3. **ï¼ˆå¯é€‰ï¼‰é›†æˆåˆ°å…¨å±€çŠ¶æ€ç®¡ç†**
4. **ï¼ˆå¯é€‰ï¼‰å¯¹æ¥åç«¯ API**

---

**æ›´æ–°æ—¶é—´**: 2025-12-11  
**çŠ¶æ€**: âœ… ä¼šå‘˜æ¥å£å·²é¢„ç•™å®Œæˆ

