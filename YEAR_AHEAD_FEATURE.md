# Year Ahead Spread 年度运势功能说明

## 功能概述

实现了经典的 **Year Ahead Spread（年度展望牌阵）**，用户可以从78张塔罗牌中抽取13张牌，获取未来一年的月度指引和年度核心主题。

## 文件结构

```
📁 components/fortune/
  └── YearAheadSlots.tsx           # 13个卡槽组件（12个月份 + 1个年度主题）

📁 pages/fortune/annual/year-ahead/
  ├── index.tsx                     # 抽牌界面
  └── result.tsx                    # 结果展示页面

📁 pages/api/
  └── year-ahead-reading.js         # AI解读API接口
```

## 功能特点

### 1. 抽牌界面 (`/fortune/annual/year-ahead`)

- **78张牌展示**：上方区域展示完整的78张随机洗牌后的塔罗牌背面
- **13个卡槽**：下方区域展示13个固定卡槽，按圆环排列
  - 1-12号位：对应一月到十二月
  - 13号位（中心）：年度主题牌
- **交互方式**：
  - 用户从上方点击任意牌
  - 被选中的牌播放动画，自动飞入下一个空卡槽
  - 抽满13张后显示「查看运势」按钮
- **状态保存**：使用localStorage保存抽牌结果，每年只能抽取一次

### 2. 结果展示 (`/fortune/annual/year-ahead/result`)

- **13张牌展示**：圆环布局展示所有抽到的牌
- **年度总结**：AI生成的全年能量概览（350字）
- **月度详解**：
  - 每月120字左右的具体指引
  - 结合月份特点、季节、节日
  - 提供具体可执行的建议
- **年度主题牌**：
  - 200字的深度解读
  - 特殊高亮显示（呼吸光效）
  - 贯穿全年的核心能量

### 3. AI解读API (`/api/year-ahead-reading`)

- **模型**：使用 DeepSeek API
- **输入**：13张牌的信息（牌名、正逆位、牌义）
- **输出**：结构化JSON数据
  ```json
  {
    "year": "2025年",
    "summary": "年度整体运势总结...",
    "cards": [
      {
        "position": "一月",
        "name": "牌名",
        "orientation": "upright",
        "meaning": "该月详细解读..."
      },
      ...
    ]
  }
  ```

## 卡槽布局设计

### 圆环布局（Year Ahead Spread 标准布局）

```
           6月       7月(顶部)       8月
      5月                                9月
   4月                                      10月
      3月       1月      13(中心)    12月       11月
           2月           年度主题
```

各位置含义：
- **1月**：新年伊始的能量和机遇
- **2月-12月**：各月份的重点事项和指引
- **13（中心）**：全年核心主题，贯穿全年的精神指引

## localStorage 数据结构

### Key格式
```
year_ahead_YYYY
```

### Value结构
```json
{
  "userId": null,
  "year": "2025",
  "cards": [
    {
      "id": 0,
      "name": "0. The Fool",
      "image": "https://...",
      "upright": "新的开始、信任直觉、勇敢冒险",
      "reversed": "冲动行事、犹豫不决、方向不明",
      "keywords": ["纯真", "自由", "机会"],
      "orientation": "upright"
    },
    ...
  ],
  "result": {
    "year": "2025年",
    "summary": "...",
    "cards": [...]
  },
  "createdAt": 1702512000000
}
```

## 使用流程

1. **首次访问**
   - 进入 `/fortune/annual/year-ahead`
   - 系统自动洗牌，展示78张牌
   - 依次点击13张牌进行抽取

2. **抽牌完成**
   - 点击「查看运势」按钮
   - 跳转到结果页面
   - AI开始生成解读（约5-10秒）

3. **再次访问**
   - 如果本年已抽取，直接显示结果
   - 无法重新抽取，需等待下一年

## 技术实现要点

### 1. 抽牌动画
- 使用 framer-motion 实现卡牌飞入动画
- 卡槽有hover效果和选中高亮
- 流畅的过渡动画

### 2. 圆环布局
- 使用绝对定位 + 百分比坐标
- 响应式设计，移动端自动适配
- 中心牌略大于月份牌

### 3. AI解读
- 生活化语言，避免玄学表述
- 结合真实场景和可执行建议
- 考虑月份特点和季节因素

## 环境变量配置

需要在 `.env.local` 中配置：

```bash
DEEPSEEK_API_KEY=your_api_key_here
```

## 样式特点

- **暗色主题**：深紫色背景 (#191022)
- **主色调**：紫色 (#7f13ec)
- **卡片**：
  - 月份牌：w-20 h-32（移动端）/ w-24 h-36（桌面端）
  - 年度主题牌：w-28 h-42（略大）
- **动画**：
  - 呼吸光效（年度主题牌）
  - 卡片飞入动画
  - 滚动淡入效果

## 访问路径

- 抽牌页面：`/fortune/annual/year-ahead`
- 结果页面：`/fortune/annual/year-ahead/result`

## 注意事项

1. **每年限抽一次**：通过localStorage的year字段控制
2. **数据持久化**：刷新页面不会丢失数据
3. **API费用**：每次生成解读会消耗约4000 tokens
4. **加载时间**：首次生成解读需要5-10秒
5. **错误处理**：API失败时会显示错误提示，可重试

## 与月度运势的差异

| 特性 | 月度运势 | 年度运势 |
|------|----------|----------|
| 卡牌数量 | 7张 | 13张 |
| 布局方式 | 六边形+中心 | 圆环+中心 |
| 时间跨度 | 1个月 | 12个月 |
| 更新频率 | 每月1次 | 每年1次 |
| 解读长度 | 150字/位置 | 120字/月 + 200字主题 |
| API Token | 约2500 | 约4000 |

## 未来优化方向

- [ ] 添加卡牌翻转动画
- [ ] 支持打印/导出PDF
- [ ] 添加分享到社交媒体功能
- [ ] 月度回顾功能（对比实际情况）
- [ ] 支持多语言（英文版）

