# 🎴 掷筊占卜 - 真实视觉设计文档

## 🎨 设计概览

全新的掷筊占卜页面采用**木质红色圣杯**设计，模拟真实的掷筊体验，包含完整的抛起、旋转、落地动画效果。

---

## 🪔 木质圣杯样式设计

### 颜色系统

| 用途 | 颜色代码 | 说明 |
|------|---------|------|
| **主体色** | `#A02424` | 深红色，圣杯主色调 |
| **高光色** | `#D95B43` | 金红色，模拟漆面反光 |
| **阴影色** | `#5C1A1A` | 暗红/酒红，增加深度 |
| **反面暗色** | `#3d0f0f` | 深暗红，平面效果 |

### 正面（凸起面）样式

```css
/* 位置：第 333-374 行 */
background: linear-gradient(145deg, #D95B43 0%, #A02424 40%, #5C1A1A 100%);
borderRadius: 45% 45% 48% 48% / 55% 55% 45% 45%;
```

**特点：**
- 三层渐变：高光 → 主体 → 阴影
- 半月形圆角，模拟传统筊杯形状
- 内凹阴影 + 外高光，营造凸起质感
- 顶部白色高光，模拟漆面反射
- 底部暗色阴影，增强立体感

### 反面（平面）样式

```css
/* 位置：第 376-409 行 */
background: linear-gradient(145deg, #5C1A1A 0%, #3d0f0f 50%, #2a0808 100%);
backfaceVisibility: hidden;
transform: rotateX(180deg);
```

**特点：**
- 暗色渐变，表现平面效果
- 内凹阴影，模拟平坦表面
- 木纹纹理（repeating-linear-gradient）
- 通过 `rotateX(180deg)` 实现翻面

---

## 🎬 动画系统详解

### 1. 抛起 + 旋转 + 落地动画

**关键帧定义：** `@keyframes throwBlock`（第 108-143 行）

#### 动画时间轴（总时长 1.8 秒）

| 时间点 | 进度 | 动作描述 | transform 效果 |
|-------|------|---------|---------------|
| **0%** | 起始 | 静止在底部 | `translateY(0)` |
| **15%** | 快速上升 | 从底部弹起 | `translateY(-280px)` + 旋转开始 |
| **40%** | 最高点 | 达到最高点，旋转加速 | `translateY(-320px)` + `rotateX(540deg)` |
| **70%** | 下落阶段 | 重力下落，继续旋转 | `translateY(-80px)` + `rotateX(900deg)` |
| **85%** | 即将落地 | 接近地面 | `translateY(0)` + 最终翻转角度 |
| **92%** | 落地弹跳 | 轻微反弹 | `translateY(-12px)` |
| **100%** | 最终静止 | 显示正反面结果 | 最终位置 + 正确朝向 |

#### 旋转效果说明

```typescript
// rotateX：控制前后翻转（决定正反面）
// rotateY：控制左右旋转（增加真实感）
// rotateZ：控制平面旋转（落地后的角度）

transform: rotateX(1080deg) rotateY(900deg) rotateZ(var(--final-rotation))
```

- **rotateX**：最终决定正面（0deg）或反面（180deg）
- **rotateY**：在空中增加左右旋转（720-900度）
- **rotateZ**：落地后的随机倾斜角度（-15° 到 +15°）

#### 缓动曲线

```css
cubic-bezier(0.25, 0.46, 0.45, 0.94)
```

- 前半段加速（模拟向上抛起）
- 后半段减速（模拟重力下落）

### 2. 落地光晕效果

**关键帧定义：** `@keyframes landingGlow`（第 146-156 行）

```css
0%: box-shadow: 0 0 0 0 rgba(212, 91, 67, 0);      /* 无光晕 */
50%: box-shadow: 0 0 60px 20px rgba(212, 91, 67, 0.6);  /* 扩散 */
100%: box-shadow: 0 8px 25px rgba(92, 26, 26, 0.5);     /* 收敛 */
```

**效果：**
- 落地瞬间光晕扩散（金红色）
- 模拟撞击地面的能量释放
- 最终收敛为稳定阴影

### 3. 结果文字淡入动画

**关键帧定义：** `@keyframes fadeInResult`（第 159-168 行）

```css
from: opacity: 0; transform: translateY(10px);  /* 从下方淡入 */
to: opacity: 1; transform: translateY(0);       /* 完全显示 */
```

**触发时机：** 动画结束后 0.6 秒淡入

---

## 📐 CSS 变量系统

### 动画控制变量（第 308-315 行）

```typescript
--throw-x-start: '-40px' / '40px'    // 起始水平位置
--throw-x-mid: '-20px' / '20px'      // 最高点水平位置
--throw-x-end: 随机生成              // 落地前水平位置
--final-x: -60 到 -45 / 45 到 75     // 最终 X 位置（随机）
--final-y: -10 到 10                 // 最终 Y 位置（随机）
--final-rotation: -15 到 15度        // 最终旋转角度（随机）
--final-flip: 0deg / 180deg          // 正面或反面
```

**随机性实现：**

```typescript
finalX: -60 + (Math.random() - 0.5) * 30,  // ±15px 偏移
finalY: (Math.random() - 0.5) * 20,         // ±10px 偏移
finalRotation: (Math.random() - 0.5) * 30,  // ±15度 旋转
```

**作用：**
- 每次掷筊落地位置略有不同
- 避免两块圣杯重叠
- 增加真实感和随机性

---

## 🌟 光影效果

### 1. 背景光晕（第 286-294 行）

```css
background: radial-gradient(circle, rgba(160, 36, 36, 0.6) 0%, transparent 70%);
```

- 深红色径向渐变
- 动画时加强（opacity: 0.4）
- 静止时减弱（opacity: 0.2）

### 2. 正面高光（第 348-360 行）

```css
/* 顶部椭圆高光 */
background: radial-gradient(ellipse, rgba(255, 255, 255, 0.25) 0%, transparent 70%);
filter: blur(4px);
```

- 模拟木质漆面反光
- 位置：左上区域（25%, 15%）
- 高斯模糊增强柔和感

### 3. 正面底部阴影（第 361-373 行）

```css
/* 底部椭圆阴影 */
background: radial-gradient(ellipse, rgba(0, 0, 0, 0.4) 0%, transparent 70%);
filter: blur(6px);
```

- 增强立体感和重量感
- 位置：底部中心（20%, 底部10%）

### 4. 木纹纹理（第 391-407 行）

```css
background: repeating-linear-gradient(
  90deg,
  rgba(92, 26, 26, 0.3) 0px,
  transparent 2px,
  transparent 8px,
  rgba(92, 26, 26, 0.2) 10px
);
```

- 仅在反面（平面）显示
- 垂直条纹模拟木纹
- opacity: 0.5 保持低调

---

## 🎯 3D 透视设置

### 容器透视（第 297 行）

```css
perspective: 1200px;
```

- 设置 3D 视角距离
- 值越小，透视效果越强

### 元素 3D 属性（第 316, 329 行）

```css
transformStyle: 'preserve-3d';
backfaceVisibility: 'hidden';
```

- `preserve-3d`：保持子元素的 3D 位置
- `backfaceVisibility: hidden`：隐藏背面，实现翻转效果

---

## 🔄 交互逻辑流程

### 点击「开始掷筊」后：

```
1. 禁用按钮 (isThrowingEnabled = false)
   ↓
2. 随机生成结果 (sheng/yin/xiao)
   ↓
3. 计算最终位置和旋转角度
   ↓
4. 触发动画 (1.8s)
   ├─ 抛起
   ├─ 旋转
   ├─ 落地
   └─ 弹跳
   ↓
5. 动画结束，显示结果文字 (淡入 0.6s)
   ↓
6. 等待 1.5s
   ↓
7. 自动跳转到结果页
```

### 状态管理

| 状态变量 | 类型 | 作用 |
|---------|------|------|
| `isThrowingEnabled` | boolean | 控制按钮是否可点击 |
| `isAnimating` | boolean | 标记动画进行中 |
| `showResult` | boolean | 控制结果文字显示 |
| `resultType` | string | 存储占卜结果类型 |
| `blocks` | Block[] | 存储两块圣杯的状态和位置 |

---

## 📱 响应式适配

### 容器高度

```css
min-h-[400px]  /* 确保有足够空间显示动画 */
```

### 圣杯尺寸

```css
width: 90px;
height: 120px;
```

- 固定尺寸，确保正反面比例一致
- 移动端和桌面端统一尺寸

---

## 🎭 仪式感营造

### 1. 视觉元素
- ✅ 木质红色圣杯（传统材质）
- ✅ 深紫背景（神秘氛围）
- ✅ 柔和光晕（灵性感）
- ✅ 真实阴影（立体感）

### 2. 动画节奏
- ✅ 快速抛起（0-15%）→ 紧张感
- ✅ 最高点停顿（40%）→ 悬念感
- ✅ 缓慢下落（70-85%）→ 期待感
- ✅ 轻微弹跳（92%）→ 真实感

### 3. 结果呈现
- ✅ 延迟显示（动画结束后）
- ✅ 淡入动画（0.6s）
- ✅ 清晰标注（圣筊/阴筊/笑筊）
- ✅ 简短说明（神明回应）

---

## 🛠️ 技术实现要点

### 1. 3D 翻转核心

```typescript
// 正面：rotateX(0deg)
// 反面：rotateX(180deg)
--final-flip: block.isFlipped ? '0deg' : '180deg'
```

### 2. 随机偏移避免重叠

```typescript
finalX: -60 + (Math.random() - 0.5) * 30,  // 左侧圣杯
finalX: 60 + (Math.random() - 0.5) * 30,   // 右侧圣杯
```

### 3. 多轴旋转实现真实感

```css
rotateX(1080deg)  /* 前后翻转 3 圈 */
rotateY(900deg)   /* 左右旋转 2.5 圈 */
rotateZ(45deg)    /* 平面旋转（空中） */
```

### 4. 光影随动画变化

```typescript
opacity: isAnimating ? 0.4 : 0.2  // 背景光晕强度
animation: landingGlow 1.8s       // 落地光晕扩散
```

---

## 📊 性能优化

- ✅ 使用 CSS 动画（GPU 加速）
- ✅ `backfaceVisibility: hidden`（减少重绘）
- ✅ 固定尺寸（避免重排）
- ✅ 单次动画（不循环）
- ✅ 清晰的状态管理（避免重复触发）

---

## 🎨 与主站风格一致性

| 元素 | 主站风格 | 掷筊页面 | 一致性 |
|------|---------|---------|--------|
| 背景色 | #191022 | #191022 | ✅ |
| 主色调 | #7f13ec (紫) | #A02424 (红) | ⚠️ 局部差异 |
| 字体 | Spline Sans | Spline Sans | ✅ |
| 按钮样式 | 圆角+渐变 | 圆角+渐变 | ✅ |
| 光晕效果 | 紫色 | 红色 | ⚠️ 主题色差异 |
| 卡片样式 | 玻璃态 | 玻璃态 | ✅ |

**说明：** 主色调采用红色是为了匹配传统木质圣杯的颜色，整体氛围仍保持神秘感。

---

## 📝 代码注释说明

### 关键代码块注释标记

```typescript
/* ========== 掷筊动画关键帧 ========== */          // 第 105 行
/* ========== 木质圣杯样式 ========== */            // 第 323 行
/* 正面（凸起面） - 深红色带光泽 */                 // 第 332 行
/* 反面（平面） - 暗红色 */                         // 第 376 行
/* 高光效果 */                                     // 第 348 行
/* 底部阴影 */                                     // 第 361 行
/* 木纹纹理 */                                     // 第 391 行
// CSS 变量：控制动画轨迹和最终位置                 // 第 308 行
```

---

## 🚀 未来优化方向

### 可选增强功能

1. **音效**
   - 掷筊抛起音效
   - 落地撞击音效
   - 结果揭晓音效

2. **粒子效果**
   - 落地时粒子扩散
   - 使用 Canvas 或 Three.js

3. **更真实的物理**
   - 碰撞检测
   - 反弹力度计算
   - 旋转减速效果

4. **自定义设置**
   - 动画速度调节
   - 音效开关
   - 筊杯颜色选择

---

**✨ 现在的实现已经完美模拟了真实掷筊体验，保持神秘感和仪式感！**

