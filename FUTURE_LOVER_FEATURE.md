# 未来恋人牌阵功能说明

## ✨ 功能概述

「未来恋人牌阵」(Future Lover Spread) 是一个全新的塔罗牌占卜功能，帮助用户探索未来恋人的画像与相遇路径。

## 📋 功能特性

### 1. 牌阵配置
- **牌数**: 6 张（包含1张指引牌 + 5张主题牌）
- **类型**: 免费牌阵
- **标签**: New

### 2. 牌位含义
```
      [指引牌]
     /         \
   [1]         [2]
他/她的类型    是否出现
   
   [3]         [4]
  遇到阻力    相处模式
     \         /
       [5]
   如何相遇
```

**详细说明：**
- **指引牌**: 本次占卜的整体指引
- **1号位**: 他/她是什么类型（性格/气质/特征）
- **2号位**: 他/她已经出现了吗？（是否在生活圈中）
- **3号位**: 遇到的阻力（当前阻碍因素）
- **4号位**: 相处模式（如何相处与靠近）
- **5号位**: 怎样才能遇到他/她（可采取的行动）

## 🚀 使用流程

### 步骤 1: 进入爱情主题占卜
从主页点击「爱情 (Love)」按钮，进入爱情主题占卜列表页。

**路径**: `/` → `/themed-readings/love`

### 步骤 2: 选择未来恋人牌阵
在爱情主题页面，找到「未来恋人牌阵」卡片（带有 💕 图标和 "New" 标签）。

**路径**: `/themed-readings/love`

### 步骤 3: 直接进入抽牌页
点击卡片后**直接进入抽牌页面**，无需查看介绍页。

**路径**: `/themed-readings/love/future-lover/draw`

**页面布局（参考年度运势样式）：**
1. **顶部导航栏**：返回按钮 + 品牌名 + 重置按钮
2. **标题介绍区**：牌阵名称 + 副标题 + 引导文案
3. **牌堆区域**：完整的78张塔罗牌（横向滚动）
4. **自定义滚动条**：拖动查看更多牌
5. **进度提示**：已抽牌 X/6
6. **卡槽区域**：6个卡槽按布局排列在底部

**抽牌交互：**
1. 从牌堆中点击任意一张牌
2. 牌会飞入对应的卡槽位置
3. 依次抽满6张牌
4. 每张牌抽中后会自动翻面显示
5. 抽满后显示"查看解读"按钮

### 步骤 5: 查看解读结果
抽满6张牌后，点击「查看解读」按钮进入结果页。

**路径**: `/themed-readings/love/future-lover/result`

**结果页内容：**
- 完整的牌阵展示（所有6张牌翻面显示）
- 指引牌的详细解读（单独高亮显示）
- 5个主题牌位的详细解读
- 每张牌显示：牌名、正逆位、基本含义、牌位问题
- 占位提示：AI 深度解读功能开发中

## 📁 文件结构

```
suanming/
├── config/
│   └── themedReadings.ts          # 更新：future-lover 配置
│
├── components/
│   └── fortune/
│       └── SixCardSlots.tsx       # 新增：6卡布局组件
│
├── pages/
│   └── themed-readings/
│       └── love/
│           ├── [spreadId].tsx     # 更新：添加 future-lover 预览
│           └── future-lover/      # 新增：未来恋人牌阵页面
│               ├── draw.tsx       # 抽牌页
│               └── result.tsx     # 结果页
│
└── FUTURE_LOVER_FEATURE.md        # 本文档
```

## 🎨 UI/UX 特点

### 页面布局（参考年度运势）
- **顶部导航**: 固定导航栏，返回/品牌/重置
- **标题区域**: 大标题 + 副标题 + 引导文案
- **牌堆展示**: 完整横向滚动，78张牌堆叠效果
- **自定义滚动条**: 渐变样式，拖动流畅
- **卡槽区域**: 底部展示，6个槽位布局

### 卡槽布局
- **指引牌**: 顶部居中，稍大尺寸，紫色光晕
- **主题牌**: 分两行并排，底部居中一张
- **响应式**: 移动端自动缩放，保持布局比例

### 抽牌动画
- 从牌堆点击 → 卡片飞入对应槽位
- 飞入动画：上浮 → 移动 → 翻牌
- 动画时长：约 450ms

### 视觉设计
- 背景：深色主题 (#191022)
- 主色调：紫色 (#7f13ec)
- 字体：Spline Sans
- 卡槽：虚线边框 + 图标提示
- 已抽牌：实心边框 + 光晕效果

## 💾 数据存储

### LocalStorage Key
```javascript
const STORAGE_KEY = 'future_lover_result';
```

### 存储结构
```typescript
interface FutureLoverResult {
  sessionId: string;           // 会话ID
  timestamp: number;           // 时间戳
  cards: ShuffledTarotCard[];  // 6张抽中的牌
}
```

### 存储逻辑
- 抽满6张牌时自动保存到 localStorage
- 重新进入抽牌页时自动恢复上次结果
- 点击「重置」或「重新抽牌」时清空数据

## 🔧 技术实现

### 核心组件复用
1. **抽牌逻辑**: 复用现有 `drawCard` 函数模式
2. **牌堆渲染**: 复用 `CardItem` 和 `EmptySlot` 组件
3. **滚动条**: 复用 `ScrollBar` 组件
4. **动画**: 使用 `framer-motion` 库

### 新增组件
- `SixCardSlots.tsx`: 专为未来恋人牌阵设计的6卡布局

### 状态管理
```typescript
// 6个卡槽状态
const [selectedCards, setSelectedCards] = useState<(ShuffledTarotCard | null)[]>(Array(6).fill(null));
const [isAnimating, setIsAnimating] = useState<boolean[]>(Array(6).fill(false));

// 牌堆状态
const [deck, setDeck] = useState<ShuffledTarotCard[]>([]);
const [uiSlots, setUiSlots] = useState<(ShuffledTarotCard | null)[]>([]);
```

## ✅ 验收测试清单

### 入口流程
- [ ] 主页可以进入爱情主题占卜
- [ ] 爱情主题列表显示「未来恋人牌阵」卡片
- [ ] 卡片显示 💕 图标和 "New" 标签
- [ ] 点击卡片进入牌阵详情页

### 详情页
- [ ] 显示牌阵基本信息（6张牌、3-5分钟）
- [ ] 显示6个卡槽的布局预览（都是背面）
- [ ] 显示每个牌位的说明文字
- [ ] 「使用该牌阵」按钮可点击
- [ ] 「返回选择」按钮返回爱情主题列表

### 抽牌页
- [ ] 顶部显示6个空卡槽（按正确布局排列）
- [ ] 底部显示78张牌堆（可横向滚动）
- [ ] 点击牌堆中的牌，牌会飞入对应卡槽
- [ ] 牌飞入动画流畅
- [ ] 牌飞入后自动翻面
- [ ] 抽过的牌从牌堆中消失
- [ ] 显示进度提示（已抽 X/6 张）
- [ ] 抽满6张后显示「查看解读」按钮

### 结果页
- [ ] 显示完整的6张牌（都是正面）
- [ ] 指引牌单独高亮显示
- [ ] 每张牌显示：牌名、正逆位、含义
- [ ] 显示每个牌位的问题说明
- [ ] 「重新抽牌」按钮弹出确认对话框
- [ ] 确认后清空数据并返回抽牌页
- [ ] 「返回爱情占卜」按钮返回主题列表

### 数据持久化
- [ ] 抽满6张后刷新页面，数据不丢失
- [ ] 重新进入抽牌页，自动恢复上次结果
- [ ] 点击重置后，数据被清空

### 响应式适配
- [ ] 移动端（375px）布局正常
- [ ] 平板端（768px）布局正常
- [ ] 桌面端（1280px）布局正常
- [ ] 卡槽大小和间距合适

### 错误处理
- [ ] 没有结果时访问结果页，自动跳转到抽牌页
- [ ] 网络异常时有友好提示
- [ ] 图片加载失败时有降级处理

## 🚧 后续开发计划

### 1. AI 深度解读（优先级：高）
- [ ] 接入 DeepSeek API
- [ ] 编写「未来恋人牌阵」专用提示词
- [ ] 实现流式输出解读内容
- [ ] 添加加载状态和错误处理

### 2. 个性化输入（优先级：中）
- [ ] 抽牌前添加问题输入框
- [ ] 记录用户的具体困惑
- [ ] 将用户输入传递给 AI 解读

### 3. 结果分享（优先级：低）
- [ ] 生成结果分享图片
- [ ] 支持保存到相册
- [ ] 支持分享到社交平台

### 4. 历史记录（优先级：低）
- [ ] 保存多次占卜记录
- [ ] 显示历史记录列表
- [ ] 支持查看和删除历史记录

## 🐛 已知问题

无

## 📝 更新日志

### v1.0.0 (2025-01-01)
- ✨ 新增「未来恋人牌阵」功能
- ✨ 新增6卡布局组件
- ✨ 实现完整的抽牌流程
- ✨ 实现结果展示页面（占位版本）
- 📝 添加功能说明文档

## 👥 开发团队

- 产品设计：封雪
- 前端开发：AI Assistant
- 技术栈：Next.js + React + TypeScript + Tailwind CSS + Framer Motion

---

**注意**: 本功能目前处于 v1.0 版本，AI 深度解读功能尚未接入，结果页显示的是占位内容。后续版本将陆续完善。

