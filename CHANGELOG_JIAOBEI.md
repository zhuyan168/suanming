# 掷筊占卜 - 更新日志

## 🎉 v2.0 - 真实木质圣杯重设计 (2025-01-09)

### ✨ 重大更新

#### 1. 全新木质圣杯视觉设计

**之前：**
- 简单的蛋形/半圆形
- 单一渐变色（金色/紫色）
- 简单的翻转效果
- 基础的抖动动画

**现在：**
- ✅ **真实木质圣杯造型**
  - 传统半月形/贝壳形状
  - 深红色木质材质 (#A02424)
  - 手工漆面光泽效果
  - 正面凸起，反面平面

- ✅ **精细的光影系统**
  - 三层颜色渐变（高光→主体→阴影）
  - 顶部高光模拟漆面反射
  - 底部阴影增强立体感
  - 反面木纹纹理效果

#### 2. 逼真的掷筊动画

**之前：**
- 简单旋转 + 抖动
- 2 秒线性动画
- 无物理感

**现在：**
- ✅ **完整的抛起 + 旋转 + 落地流程**
  - 从底部快速弹起
  - 空中三轴旋转（rotateX + rotateY + rotateZ）
  - 达到最高点（320px）
  - 重力下落
  - 落地轻微弹跳
  - 总时长 1.8 秒

- ✅ **物理真实感**
  - cubic-bezier 缓动曲线
  - 重力加速效果
  - 落地反弹效果

- ✅ **落地光晕效果**
  - 金红色光晕扩散
  - 模拟撞击能量释放
  - 最终收敛为稳定阴影

#### 3. 随机性增强

**之前：**
- 固定位置
- 可能重叠

**现在：**
- ✅ 每次落地位置随机偏移（±15px）
- ✅ 落地后随机旋转角度（±15°）
- ✅ 垂直位置微调（±10px）
- ✅ 完全避免重叠

#### 4. 结果呈现优化

**之前：**
- 动画结束立即跳转
- 无结果预览

**现在：**
- ✅ 动画结束后显示结果
- ✅ 结果文字淡入动画（0.6s）
- ✅ 停留 1.5 秒供观看
- ✅ 自动跳转到详细结果页

### 🎨 视觉改进

#### 颜色系统更新

| 元素 | 之前 | 现在 |
|------|------|------|
| 正面主色 | #fbbf24 (金色) | #A02424 (深红) |
| 正面高光 | - | #D95B43 (金红) |
| 正面阴影 | - | #5C1A1A (暗红) |
| 反面颜色 | 紫色 (#7f13ec) | #3d0f0f (深暗红) |
| 背景光晕 | 紫色 | 红色 |

#### 3D 效果增强

- ✅ 透视距离设置（1200px）
- ✅ 正反面厚度感（translateZ: 8px）
- ✅ 背面可见性控制（backfaceVisibility: hidden）
- ✅ 3D 变换保持（transformStyle: preserve-3d）

### 🔧 技术改进

#### 代码结构优化

```typescript
// 新增类型定义
interface Block {
  id: number;
  isFlipped: boolean;
  finalX: number;      // 最终 X 位置
  finalY: number;      // 最终 Y 位置
  finalRotation: number; // 最终旋转角度
}
```

#### 状态管理增强

```typescript
// 新增状态
const [showResult, setShowResult] = useState(false);
const [resultType, setResultType] = useState<ResultType | null>(null);
```

#### CSS 变量系统

使用 CSS 变量控制动画：
- `--throw-x-start`：起始位置
- `--throw-x-mid`：最高点位置
- `--throw-x-end`：落地前位置
- `--final-x/y`：最终位置
- `--final-rotation`：最终旋转
- `--final-flip`：正反面控制

### 📊 性能优化

- ✅ GPU 加速（CSS transform）
- ✅ 减少重绘（backfaceVisibility: hidden）
- ✅ 固定尺寸（避免布局重排）
- ✅ 单次动画（不循环）

### 🎭 用户体验提升

#### 动画时间轴

| 阶段 | 时长 | 用户感受 |
|------|------|---------|
| 抛起 | 0.27s | 紧张感、期待感 |
| 最高点 | 0.45s | 悬念感 |
| 下落 | 0.54s | 期待感加强 |
| 落地 | 0.27s | 揭晓感 |
| 弹跳 | 0.27s | 真实感 |
| **总计** | **1.8s** | **完整仪式感** |

#### 视觉反馈

1. **点击按钮前**
   - 提示文字：「在心中默念你的问题」
   - 圣杯静止在底部

2. **动画进行中**
   - 按钮禁用，显示「掷筊中...」
   - 背景光晕加强
   - 圣杯飞舞旋转

3. **动画结束后**
   - 圣杯落地，显示正反面
   - 结果文字淡入
   - 简短说明神明回应

4. **1.5 秒后**
   - 自动跳转详细结果页

### 🪄 神秘感营造

#### 材质选择
- ✅ 木质红色（传统材质）
- ✅ 手工漆面光泽
- ✅ 深暗背景（夜空般）

#### 光影设计
- ✅ 柔和光晕（神性）
- ✅ 动态阴影（立体感）
- ✅ 落地光爆（能量感）

#### 动画节奏
- ✅ 缓慢启动（仪式感）
- ✅ 快速上升（紧张感）
- ✅ 悬停最高点（期待感）
- ✅ 重力下落（真实感）

### 📝 代码质量

#### 新增注释

所有关键代码块都添加了详细注释：

```typescript
/* ========== 掷筊动画关键帧 ========== */
/* ========== 木质圣杯样式 ========== */
/* 正面（凸起面） - 深红色带光泽 */
/* 反面（平面） - 暗红色 */
/* 高光效果 */
/* 底部阴影 */
/* 木纹纹理 */
// CSS 变量：控制动画轨迹和最终位置
```

#### 类型安全

- ✅ TypeScript 接口定义
- ✅ 类型检查完整
- ✅ 无 any 类型

### 🐛 Bug 修复

- ✅ 修复圣杯可能重叠的问题
- ✅ 修复结果提前显示的问题
- ✅ 修复动画卡顿问题
- ✅ 优化 3D 翻转效果

---

## 📦 文件变更

### 修改的文件

```
pages/divination/jiaobei/index.tsx  [重大更新]
├─ 新增 Block 接口定义
├─ 重写 throwBlocks 函数
├─ 完全重设计圣杯样式
├─ 重构动画关键帧
├─ 新增结果预览功能
└─ 优化交互逻辑
```

### 新增的文件

```
JIAOBEI_DESIGN.md        [设计文档]
CHANGELOG_JIAOBEI.md     [本文件]
```

---

## 🎯 设计目标达成度

| 目标 | 状态 | 说明 |
|------|------|------|
| 木质红色圣杯 | ✅ 完成 | 深红色渐变 + 光泽效果 |
| 半月形/贝壳形 | ✅ 完成 | 使用 borderRadius 实现 |
| 正面凸起质感 | ✅ 完成 | 内外阴影 + 高光 |
| 反面平面效果 | ✅ 完成 | 暗色 + 木纹纹理 |
| 真实抛起动画 | ✅ 完成 | 完整的物理轨迹 |
| 空中旋转 2-3 圈 | ✅ 完成 | 三轴旋转 |
| 落地弹跳效果 | ✅ 完成 | 轻微反弹 |
| 落地光晕扩散 | ✅ 完成 | 金红色光爆 |
| 随机位置偏移 | ✅ 完成 | ±15px 偏移 |
| 仪式感营造 | ✅ 完成 | 完整时间轴设计 |

**达成度：100% ✨**

---

## 🚀 后续计划

### 可能的增强功能

1. **音效系统**
   - [ ] 掷筊抛起音效
   - [ ] 落地撞击音效
   - [ ] 结果揭晓音效
   - [ ] 背景氛围音乐

2. **粒子效果**
   - [ ] 落地粒子扩散
   - [ ] Canvas/Three.js 实现
   - [ ] 光点飘散效果

3. **更多交互**
   - [ ] 手动拖拽掷筊
   - [ ] 摇一摇触发
   - [ ] 长按蓄力

4. **数据记录**
   - [ ] 历史占卜记录
   - [ ] 统计分析
   - [ ] 分享功能

---

## 📸 视觉对比

### 之前
```
🥚 简单蛋形
├─ 单色渐变
├─ 基础翻转
├─ 简单抖动
└─ 立即跳转
```

### 现在
```
🪵 真实木质圣杯
├─ 三层渐变
├─ 3D 翻转
├─ 完整抛起轨迹
├─ 落地弹跳
├─ 光晕效果
├─ 结果预览
└─ 延迟跳转
```

---

**✨ v2.0 带来了完全重设计的掷筊体验，更真实、更神秘、更具仪式感！**

---

*更新时间：2025-01-09*
*文档版本：2.0*

